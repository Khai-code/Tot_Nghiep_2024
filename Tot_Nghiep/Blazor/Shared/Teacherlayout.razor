@using global::Data.DTOs
@inherits LayoutComponentBase
@inject IJSRuntime jsRuntime
@inject HttpClient httpclient
@inject NavigationManager navigate
<main>
    <div class=" row">
    <div class="col-2">
        <div class="container-fluid shadow min-vh-100 bg-light" >
            <div class="d-flex justify-content-center">
                <img src="img/Rectangle89.png" style="height:150px" alt="Alternate Text" />
            </div>
            <div>
                    <nav class="flex-column justify-content-center" style="font-family:Arial ;color:rgba(22, 105, 135, 1)">
                    <div class="nav-item p-1 ">
                        <NavLink class="nav-link p-1 " href="" aria-hidden="true"><i class="bi bi-house-door text-primary fs-4 m-1"></i>Trang chủ</NavLink>
                    </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="" aria-hidden="true"><i class="bi bi-mortarboard text-primary fs-4 m-1"></i>Quản lý lớp học</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="quanlystudent" aria-hidden="true"><i class="bi bi-mortarboard text-primary fs-4 m-1"></i>Quản lý học sinh</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="manage-test" aria-hidden="true"><i class="bi bi-book text-primary fs-4 m-1"></i>Quản lý đề thi</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="create-question" aria-hidden="true">
                                <i class="bi bi-card-checklist text-primary fs-4 m-1"></i>Quản lý câu hỏi
                                <ul>
                                    <li>Danh sác câu hỏi</li>
                                    <div>
                                        <NavLink href="add-question">Tạo Câu hỏi</NavLink>
                                    </div>
                                    <div>
                                    <NavLink href="upload-question">Upload câu hỏi</NavLink>
                                    </div>
                                </ul>
                            </NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="exam-room" aria-hidden="true"><i class="bi bi-stopwatch text-primary fs-4 m-1"></i>Quản lý ca thi</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="exam-room" aria-hidden="true"><i class="bi bi-stopwatch text-primary fs-4 m-1"></i>Điểm</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="exam-result" aria-hidden="true"><i class="bi bi-layout-text-window-reverse text-primary fs-4 m-1"></i>Quản lý phúc khảo bài thi</NavLink>
                        </div>
                        <div class="nav-item p-1 ">
                            <NavLink class="nav-link p-1" href="teacher-system" aria-hidden="true"><i class="bi bi-info-square text-primary fs-4 m-1"></i>Quản lý thông tin liên hệ</NavLink>
                        </div>

                </nav>
            </div>
            
        </div>
        
    </div>
    <div class="col-10">
        <div class="row">
            <nav >
                <div class=" bg-light shadow-sm " style="height:100px">
                    <div class="d-flex justify-content-end container align-items-center pt-2">
                            <i class="bi bi-person-circle fs-2 text-primary"></i>
                            @if (tokenResponse != null)
                            {
                                <span class="nav-link fw-bold text-black-50 p-2">@ShortenContent(userName, 15)</span>
                                <NavLink href="#" @onclick="HandleLogout" class="nav-link fw-bold text-black-50 p-2">Đăng xuất</NavLink>
                            }
                        </div>
                        <hr />
                </div>
            </nav>
        </div>
        <div class="row">
                <article class="container">
                    @Body
                </article>
        </div>
    </div>
    </div>
  
    
</main>
@code {
    private TokenResponse tokenResponse;
    private string userName;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var token = await jsRuntime.InvokeAsync<string>("localStorage.getItem", "YourSuperSecretKeyHere");

            if (!string.IsNullOrEmpty(token))
            {
                tokenResponse = new TokenResponse { Token = token };
                var handler = new System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler();
                var jsonToken = handler.ReadToken(token) as System.IdentityModel.Tokens.Jwt.JwtSecurityToken;
                userName = jsonToken?.Claims.FirstOrDefault(c => c.Type == "name")?.Value;
                StateHasChanged();
            }
        }
    }
    private async Task HandleLogout()
    {
        var response = await httpclient.PostAsync("api/User/logout", null);

        if (response.IsSuccessStatusCode)
        {
            await jsRuntime.InvokeVoidAsync("localStorage.removeItem", "YourSuperSecretKeyHere");
            tokenResponse = null;
            userName = null;
            navigate.NavigateTo("/");
        }
    }
    private string ShortenContent(string content, int maxLength)
    {
        if (string.IsNullOrEmpty(content))
        {
            return content;
        }
        return content.Length > maxLength ? content.Substring(0, maxLength) + "..." : content;
    }
}
<style>
    .row{
        --bs-gutter-x: 0;
    }
    .nav-link:hover{
        color:royalblue;
        font-weight:bold;
        font-size:15px;

    }

</style>

